<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content="The complete guide to building a WhatsApp API using Node.js, Express and whatsapp-web.js"> <meta name="twitter:description" content="The complete guide to building a WhatsApp API using Node.js, Express and whatsapp-web.js"> <meta property="og:description" content="The complete guide to building a WhatsApp API using Node.js, Express and whatsapp-web.js"> <meta property="og:type" content="article"> <meta property="og:title" content="Building a WhatsApp API using Node.js &amp; Express"> <meta property="og:image" content="https://cdn.hashnode.com/res/hashnode/image/upload/v1641723506307/rnT9FncaZ.png"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@genicsblog"> <meta name="twitter:image" content="https://cdn.hashnode.com/res/hashnode/image/upload/v1641723506307/rnT9FncaZ.png"> <meta name="twitter:creator" content="@MaxProgramming1"> <meta property="og:type" content="article"> <meta property="og:url" content="https://genicsblog.com/usman/whatsapp-api-with-node-js-and-express"> <link rel="canonical" href="https://blog.usman-s.me/whatsapp-api-node-express"> <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/theme.css"> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> <link href="https://fonts.googleapis.com/css2?family=Fira+Code&amp;family=Sen&amp;display=swap" rel="stylesheet"> <link rel="stylesheet" href="/assets/css/prism.css"> <script>localStorage.getItem("color-theme")?"light"===localStorage.getItem("color-theme")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light"),localStorage.setItem("rotated","false")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"),localStorage.setItem("rotated","true")):(localStorage.setItem("color-theme","light"),localStorage.setItem("rotated","false"));</script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-KQJM9Z9N1Z"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KQJM9Z9N1Z");</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8114751086331659" crossorigin="anonymous"></script> <title>Building a WhatsApp API using Node.js &amp; Express</title> </head> <body> <nav> <p class="bg-primary p-3 text-center text-white font-medium flex flex-col sm:block"> <span class="md:hidden px-1">Connect with us on discord to stay updated.</span> <span class="hidden md:inline px-1">Connect with us on discord to stay updated on the blog's development.</span> <a href="https://discord.genicsblog.com" target="_blank" class="font-bold underline header-anchor hover:text-slate-300" rel="nofollow noopener noreferrer"> Join &gt; </a> </p> <header class="w-full top-0 z-10" id="navbar"> <div class="bg-background max-h-20 py-1 px-2 sm:px-8 lg:px-8 mx-auto"> <div class="flex justify-between h-16"> <div class="flex px-2 lg:px-0"> <a class="group flex-shrink-0 flex items-center logo-anchor" href="/" aria-label="Home Page Link"> <div class="flex items-center space-x-2 whitespace-nowrap flex-nowrap"> <div class="h-8 w-8 mx-2"> <svg class="h-8 w-8 fill-white group-hover:fill-slate-300" viewbox="0 0 79.784508 91.197495" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <g id="layer1" transform="translate(-68.235445,-52.679805)"> <path id="path962" style="stroke:none;stroke-width:0.999999px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m 408.73047,210.44336 -139.49414,80.59961 0.87109,162.49414 52.71289,-32.94922 85.34766,48.85938 87.42773,-48.85743 -0.63476,-53.22851 -84.8711,-0.88477 v 27.79297 h 56.02735 v 9.45508 l -58.31446,33.66797 -56.13085,-32.4082 0.63476,-66.94922 55.81836,-32.22461 57.25195,32.76172 82.41016,-47.75782 z m 0.43945,32.62695 83.28125,48.08203 -26.93555,15.55274 -57.21484,-33.0332 -84.18359,48.60351 v 66.39453 l -25.48047,14.71094 0.084,-96.54102 z" transform="scale(0.26458333)"></path> <path style="stroke:none;stroke-width:0.264583px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m 81.889144,125.74786 26.204966,15.12944 36.92584,-21.31914 V 88.998204 l -7.22758,4.172845 V 115.03627 L 108.1902,132.12709 89.310794,121.22706 Z" id="path1416"></path> </g> </svg> </div> <span class="font-bold hidden sm:block text-xl tracking-tight text-white group-hover:text-slate-300"> Genics Blog</span> </div> </a> </div> <div class="flex items-center h-16"> <div class="hidden lg:block"> <a class="nav-item text-white" href="/topics">Topics</a> <a class="nav-item text-white" href="/about">About Us</a> <a class="nav-item text-white" href="/contact">Contact</a> <a class="nav-item text-white" target="_blank" href="https://docs.genicsblog.com">Docs</a> </div> <button onclick="showSearch()" aria-label="Search for posts"> <svg xmlns="http://www.w3.org/2000/svg" class="ml-4 h-6 w-6 stroke-white hover:stroke-slate-300" fill="none" viewbox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path> </svg> </button> <button type="button" class="ml-2" onclick="toggleTheme()" title="Ctrl + Shift + L"> <svg viewbox="0 0 512 512" class="h-8 w-8 fill-white hover:fill-slate-300 transition-all" id="theme-toggle-icon"> <g> <path d="M262.524,164.624c-49.466,0-89.592,40.119-89.592,89.596c0,49.487,40.126,89.606,89.592,89.606 c49.487,0,89.613-40.119,89.613-89.606C352.138,204.743,312.012,164.624,262.524,164.624z M262.524,320.136 c-36.39,0-65.902-29.513-65.902-65.916c0-36.396,29.513-65.903,65.902-65.903c36.41,0,65.924,29.506,65.924,65.903 C328.448,290.623,298.935,320.136,262.524,320.136z"></path> <path d="M264.078,149.221c0,0-39.031-73.758,0-73.758C303.103,75.462,264.078,149.221,264.078,149.221z"></path> <path d="M261.922,363.328c0,0,39.053,73.737,0,73.737C222.905,437.045,261.922,363.328,261.922,363.328z"></path> <path d="M186.536,331.194c0,0-24.539,79.766-52.142,52.148C106.817,355.746,186.536,331.194,186.536,331.194z"></path> <path d="M155.941,255.181c0,0-73.745,39.048-73.745,0C82.224,216.177,155.941,255.181,155.941,255.181z"></path> <path d="M188.068,179.794c0,0-79.746-24.524-52.142-52.142C163.503,100.086,188.068,179.794,188.068,179.794z"></path> <path d="M428.852,254.552c0,49.668-40.276,89.931-89.935,89.931c-49.657,0-89.928-40.263-89.928-89.931 c0-49.672,40.271-89.928,89.928-89.928C388.575,164.624,428.852,204.88,428.852,254.552z"></path> </g> </svg> </button> <a class="ml-4 px-2.5 py-1.5 font-bold rounded-md text-black bg-white hover:bg-slate-300 hover:scale-110 transition underline-none" href="/contribute">Contribute</a> <div class="ml-4 lg:hidden cursor-pointer"> <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 stroke-white hover:stroke-slate-300" id="menu-open" viewbox="0 0 24 24" onclick="toggleNav()"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path> </svg> <svg xmlns="http://www.w3.org/2000/svg" class="menu-close h-8 w-8 hidden stroke-white hover:stroke-slate-300" id="menu-close" viewbox="0 0 24 24" onclick="toggleNav()"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path> </svg> </div> </div> </div> </div> <div class="top-0 bg-background hidden p-6 lg:hidden" id="mobile-nav"> <div class="grid grid-cols-2 gap-y-2 gap-x-4"> <a class="group mobile-nav-item " href="/topics"> <span class="group-hover:text-white">Topics</span> </a> <a class="group mobile-nav-item " href="/about"> <span class="group-hover:text-white">About Us</span> </a> <a class="group mobile-nav-item " href="/contact"> <span class="group-hover:text-white">Contact</span> </a> <a class="group mobile-nav-item" href="https://docs.genicsblog.com" target="_blank"> <span class="group-hover:text-white">Documentation</span> </a> </div> </div> </header> </nav> <header class="bg-background text-white p-6 sm:p-10" id="banner"> <div class="flex flex-col lg:flex-row p-2"> <div class="flex justify-center items-center lg:w-1/2 md:mb-0"> <img src="https://ik.imagekit.io/genicsblog/tr:w-1920,h-1080,f-webp/https://cdn.hashnode.com/res/hashnode/image/upload/v1641723506307/rnT9FncaZ.png" class="w-full md:w-3/4 lg:w-full rounded-xl shadow-xl aspect-video m-8" loading="lazy"> </div> <div class="flex flex-col justify-center lg:items-start w-full lg:w-1/2 lg:ml-12"> <h1 class="text-4xl font-black tracking-tight">Building a WhatsApp API using Node.js &amp; Express</h1> <span class="mt-0.5 text-justify">The complete guide to building a WhatsApp API using Node.js, Express and whatsapp-web.js</span> <div class="flex items-center mt-8"> <img class="rounded-full w-14 h-14" src="https://i.ibb.co/Fs6Kww8/PFP.jpg" loading="lazy"> <div class="ml-4 leading-3"> <a class="font-extrabold text-xl" href="/author/usman/"> Usman Sabuwala </a> <br> <span class="text-sm"> Posted on January 9, 2022 </span> </div> </div> <div class="mt-8"> <span>Category: </span> <a class="text-sm ml-2 archive-name !bg-backend underline-none" href="/category/backend">#backend</a> </div> <div class="mt-4 sm:mt-3"> <span>Tags: </span> <a class="text-sm ml-2 my-0.5 archive-name !bg-node-js underline-none" href="/tag/node-js">#node-js</a> <a class="text-sm ml-2 my-0.5 archive-name !bg-api underline-none" href="/tag/api">#api</a> </div> </div> </div> </header> <main> <section class="lg:flex"> <div class="md:text-lg m-6 md:m-10 lg:m-14 lg:w-full lg:max-w-[65%] xl:max-w-[70%]"> <div class="bg-white dark:bg-background rounded-2xl shadow-xl shadow-slate-200 dark:shadow-none"> <div class="notice w-full px-4 py-2 rounded-tl-2xl rounded-tr-2xl bg-slate-200 dark:bg-slate-800 space-y-4"> <span class="text-base italic leading-8"> Originally published at <a href="https://blog.usman-s.me/whatsapp-api-node-express" target="_blank" rel="nofollow noopener noreferrer">blog.usman-s.me</a>. </span> </div> <article class="p-6 md:p-8"> <div class="mb-6"> <iframe allowfullscreen="false" data-src="https://audio.beyondwords.io/m/3468270" frameborder="0" id="speechkit-io-iframe" scrolling="no" class="rounded-xl" style="display: none"></iframe> <script src="https://proxy.beyondwords.io/npm/@beyondwords/audio-player@latest/dist/module/iframe-helper.js" type="text/javascript"></script> </div> <p><img src="https://ik.imagekit.io/genicsblog/tr:f-webp/https://c.tenor.com/8GDoVtr9mvQAAAAC/hey-everyone-spider-man.gif" alt="hey.gif" loading="lazy"></p> <p>Today, you will learn to build a <strong>WhatsApp REST API</strong> using Node.js and Express using Puppeteer and web scraping!</p> <p>Although we won‚Äôt be doing actual web scraping, we will use a library that does everything for you and makes it very easy to work with WhatsApp programmatically.</p> <h2 id="setup">Setup</h2> <h3 id="express-server-setup">Express server setup</h3> <p>To set up the express server, we are not going to do it from scratch, we‚Äôll use a generator called <a href="https://npmjs.org/express-draft" rel="nofollow noopener noreferrer" target="_blank"><code class="language-plaintext highlighter-rouge">express-draft</code></a> by <a href="https://www.youtube.com/c/yoursTRULY267" rel="nofollow noopener noreferrer" target="_blank">YoursTruly</a>. First, install <code class="language-plaintext highlighter-rouge">express-draft</code> globally and use the following command to generate an express app.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i <span class="nt">-g</span> express-draft
exp <span class="nb">.</span>
</code></pre></div></div> <p><img src="https://ik.imagekit.io/genicsblog/tr:f-webp/https://cdn.hashnode.com/res/hashnode/image/upload/v1641634524269/MM1PjxGlU.png" alt="image.png" loading="lazy"></p> <h3 id="install-whatsapp-web-library">Install Whatsapp Web library</h3> <blockquote> <p><strong>Caution</strong>: Installing this package will also download Chromium because of Puppeteer. To disable Chromium download, follow the steps on <a href="https://blog.usman-s.me/how-to-skip-chromium-download-in-puppeteer" rel="nofollow noopener noreferrer" target="_blank">this post</a>.</p> </blockquote> <p>There‚Äôs an awesome <a href="https://github.com/pedroslopez/whatsapp-web.js" rel="nofollow noopener noreferrer" target="_blank">open-source Whatsapp client</a> that connects through the Whatsapp Web browser app made by <a href="https://twitter.com/pedroslopez" rel="nofollow noopener noreferrer" target="_blank">Pedro S. Lopez</a>.</p> <p>First, we‚Äôll install it through <strong>npm</strong> (or <strong>yarn</strong>).</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i whatsapp-web.js
</code></pre></div></div> <p>After we‚Äôre done with that, we can set it up in our <code class="language-plaintext highlighter-rouge">app.js</code> file by following the given <a href="https://github.com/pedroslopez/whatsapp-web.js/blob/main/example.js" rel="nofollow noopener noreferrer" target="_blank">example</a>.</p> <p>We can alter the file as follows:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">createError</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http-errors</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">morgan</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">morgan</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">Client</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">whatsapp-web.js</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">dotenv</span><span class="dl">'</span><span class="p">).</span><span class="nx">config</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">SESSION_FILE_PATH</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">./session.json</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">sessionCfg</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">SESSION_FILE_PATH</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">sessionCfg</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">SESSION_FILE_PATH</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">({</span>
  <span class="na">puppeteer</span><span class="p">:</span> <span class="p">{</span> <span class="na">headless</span><span class="p">:</span> <span class="kc">false</span> <span class="p">},</span> <span class="c1">// Make headless true or remove to run browser in background</span>
  <span class="na">session</span><span class="p">:</span> <span class="nx">sessionCfg</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
</code></pre></div></div> <p>While using this library, whenever a user logs in, their information will be stored in a <code class="language-plaintext highlighter-rouge">session.json</code> file, which is then used to authenticate the user the next time when the server starts.</p> <p><strong>Important</strong>: Create a <code class="language-plaintext highlighter-rouge">nodemon.json</code> file in the root folder and add these contents to ignore the <code class="language-plaintext highlighter-rouge">session.json</code> file whenever it changes.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//</span><span class="w"> </span><span class="s2">"$schema"</span><span class="w"> </span><span class="err">can</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">omitted.</span><span class="w"> </span><span class="err">It's</span><span class="w"> </span><span class="err">just</span><span class="w"> </span><span class="err">used</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">IntelliSense.</span><span class="w"> </span><span class="err">REMOVE</span><span class="w"> </span><span class="err">THIS</span><span class="w"> </span><span class="err">COMMENT</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"$schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://json.schemastore.org/nodemon.json"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"ignore"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"session.json"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h2 id="creating-routes-and-user-login">Creating routes and user login</h2> <h3 id="using-events">Using events</h3> <p><code class="language-plaintext highlighter-rouge">whatsapp-web.js</code> has a lot of events to work with, and we‚Äôll now use some of them to get the QR code, check the authentication, etc.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Add this after express code but before starting the server</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">qr</span><span class="dl">'</span><span class="p">,</span> <span class="nx">qr</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// NOTE: This event will not be fired if a session is specified.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">QR RECEIVED</span><span class="dl">'</span><span class="p">,</span> <span class="nx">qr</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/getqr</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">qr</span> <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">authenticated</span><span class="dl">'</span><span class="p">,</span> <span class="nx">session</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">AUTHENTICATED</span><span class="dl">'</span><span class="p">,</span> <span class="nx">session</span><span class="p">);</span>
  <span class="nx">sessionCfg</span> <span class="o">=</span> <span class="nx">session</span><span class="p">;</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">SESSION_FILE_PATH</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">session</span><span class="p">),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">auth_failure</span><span class="dl">'</span><span class="p">,</span> <span class="nx">msg</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Fired if session restore was unsuccessfull</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">AUTHENTICATION FAILURE</span><span class="dl">'</span><span class="p">,</span> <span class="nx">msg</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">ready</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">READY</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Listening for the server</span>
<span class="kd">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`üöÄ @ http://localhost:</span><span class="p">${</span><span class="nx">PORT</span><span class="p">}</span><span class="s2">`</span><span class="p">));</span>
</code></pre></div></div> <p>The above code uses events provided by the library to tackle different situations. They are pretty self-explanatory so I am not gonna explain each of them.</p> <p>In the <code class="language-plaintext highlighter-rouge">qr</code> event, we create a route that sends the QR code as the response. The QR code is in raw format, meaning it needs to be generated so for the purpose of this tutorial, we‚Äôll use a library called <code class="language-plaintext highlighter-rouge">qrcode-terminal</code> to show the QR Code in the terminal.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Run `npm i qrcode-terminal` before adding this code</span>

<span class="kd">const</span> <span class="nx">qrcode</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">qrcode-terminal</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">qr</span><span class="dl">'</span><span class="p">,</span> <span class="nx">qr</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// NOTE: This event will not be fired if a session is specified.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">QR RECEIVED</span><span class="dl">'</span><span class="p">,</span> <span class="nx">qr</span><span class="p">);</span>
  <span class="nx">qrcode</span><span class="p">.</span><span class="nx">generate</span><span class="p">(</span><span class="nx">qr</span><span class="p">,</span> <span class="p">{</span> <span class="na">small</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span> <span class="c1">// Add this line</span>
  <span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/getqr</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">qr</span> <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div> <h3 id="the-sendmessage-endpoint">The <code class="language-plaintext highlighter-rouge">sendmessage</code> endpoint</h3> <p>Now that we have everything set up, let‚Äôs do the most exciting part that is to send a message using our own API.</p> <p>For that, we create a route in the <code class="language-plaintext highlighter-rouge">app.js</code> file itself.</p> <p>Let‚Äôs create the POST endpoint for <code class="language-plaintext highlighter-rouge">sendmessage</code> and it will be an <code class="language-plaintext highlighter-rouge">async</code> function with a try-catch block.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/sendmessage</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Magic happens here</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">next</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div> <p>In the body of the request, the user has to enter two pieces of data.</p> <ol> <li>Mobile number</li> <li>Message</li> </ol> <p>We‚Äôll identify those as <code class="language-plaintext highlighter-rouge">number</code> and <code class="language-plaintext highlighter-rouge">message</code> respectively. We will get them from the request body, and use them to easily send the message <strong>from the client to the given number</strong>.</p> <p>To send a message, we use the <code class="language-plaintext highlighter-rouge">client.sendMessage</code> method. These are the arguments we need to pass in</p> <p><img src="https://ik.imagekit.io/genicsblog/tr:f-webp/https://cdn.hashnode.com/res/hashnode/image/upload/v1641641747436/t-Pzomgq-.png" alt="image.png" loading="lazy"></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/sendmessage</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">number</span><span class="p">,</span> <span class="nx">message</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span> <span class="c1">// Get the body</span>
    <span class="kd">const</span> <span class="nx">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">number</span><span class="p">}</span><span class="s2">@c.us`</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span> <span class="c1">// Send the message</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">msg</span> <span class="p">});</span> <span class="c1">// Send the response</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">next</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div> <p>Now here, in the <code class="language-plaintext highlighter-rouge">sendMessage</code> method, we pass in the mobile number and the message itself. With the mobile number, we have to attach <code class="language-plaintext highlighter-rouge">@c.us</code> at the very end, so we do that with template literals in JavaScript.</p> <h2 id="testing-the-api">Testing the API</h2> <p>In order to test our API, we first run it using the command <code class="language-plaintext highlighter-rouge">npm run dev</code>. That will open up a browser (if you‚Äôve set <code class="language-plaintext highlighter-rouge">headless</code> to <code class="language-plaintext highlighter-rouge">false</code>)</p> <p>Running the server will give us the QR Code to authenticate because it‚Äôs the first time you run it. So, you have to scan it through WhatsApp.</p> <p><img src="https://ik.imagekit.io/genicsblog/tr:f-webp/https://cdn.hashnode.com/res/hashnode/image/upload/v1641642355849/9jDhG2-nd.png" alt="image.png" loading="lazy"></p> <p>Once authenticated, you will notice that a <code class="language-plaintext highlighter-rouge">session.json</code> file has been created with the following contents.</p> <p><img src="https://ik.imagekit.io/genicsblog/tr:f-webp/https://cdn.hashnode.com/res/hashnode/image/upload/v1641642315529/HTwbVxMBq.png" alt="image.png" loading="lazy"></p> <p>Now in VS Code itself, we‚Äôll use an extension called <strong>Thunder Client</strong>, which works like Postman for API testing. <a href="https://marketplace.visualstudio.com/items?itemName=rangav.vscode-thunder-client" rel="nofollow noopener noreferrer" target="_blank">Here‚Äôs the link</a> to install it.</p> <p><img src="https://ik.imagekit.io/genicsblog/tr:f-webp/https://cdn.hashnode.com/res/hashnode/image/upload/v1641642506648/MYLChp2-l.png" alt="image.png" loading="lazy"></p> <p>Create a <strong>New Request</strong> in Thunder Client, and then add the following details. In the <code class="language-plaintext highlighter-rouge">number</code> field, add the mobile number followed by the country code of the number.</p> <p><img src="https://ik.imagekit.io/genicsblog/tr:f-webp/https://cdn.hashnode.com/res/hashnode/image/upload/v1641645569198/ysdOUnwwE.png" alt="image.png" loading="lazy"></p> <blockquote> <p>Look at the image carefully</p> </blockquote> <p>And then hit <strong>Send</strong>.</p> <p>If the message is sent successfully, the number you entered will receive it and you will get back the <code class="language-plaintext highlighter-rouge">msg</code> as the response. If not, you will get an error.</p> <p><img src="https://ik.imagekit.io/genicsblog/tr:f-webp/https://cdn.hashnode.com/res/hashnode/image/upload/v1641643609398/muQhzRQSn.png" alt="image.png" loading="lazy"></p> <p><img src="https://ik.imagekit.io/genicsblog/tr:f-webp/https://c.tenor.com/68a5_Ug62VYAAAAM/success-strong.gif" alt="success.gif" loading="lazy"></p> <h2 id="conclusion">Conclusion</h2> <p>You can read more about the library here:</p> <p><a href="https://wwebjs.dev" rel="nofollow noopener noreferrer" target="_blank">https://wwebjs.dev</a></p> <p>I hope you enjoyed building out the WhatsApp API using Node.js, Express, and <code class="language-plaintext highlighter-rouge">whatsapp-web.js</code>.</p> <p>Comment down your thoughts! There is always room for improvement so let me know your suggestions on this project!</p> <p><strong>Connect with me on my <a href="https://youtube.com/MaxProgramming" rel="nofollow noopener noreferrer" target="_blank">YouTube channel</a> and my <a href="https://twitter.com/maxprogramming1" rel="nofollow noopener noreferrer" target="_blank">Twitter</a> üòâ</strong></p> <p>Until next time, keeping awesome ‚úåÔ∏è.</p> </article> <hr> <div class="px-6 pb-6 md:px-8 md:pb-8 flex flex-col items-center rounded-bl-2xl rounded-br-2xl"> <p class="text-center mb-4">Join discussions at <a href="https://discord.genicsblog.com" target="_blank" class="cta-link">our discord server &gt;</a><br>Did you learn something new today? Spread the word!</p> <div class="grid grid-flow-col gap-6"> <a class="underline-none hover:scale-125 transition flex items-center" rel="nofollow noopener noreferrer" href="https://facebook.com/sharer.php?u=Check%20out%20this%20amazing%20article%20at%20Genics%20Blog%20'Building%20a%20WhatsApp%20API%20using%20Node.js%20&amp;%20Express':%20https://genicsblog.com/usman/whatsapp-api-with-node-js-and-express" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;" target="_blank"> <img src="/assets/images/social/facebook.svg" class="social-image w-8 h-8" loading="lazy"> </a> <a class="underline-none hover:scale-125 transition flex items-center" rel="nofollow noopener noreferrer" href="https://api.whatsapp.com/send?text=Checkout%20this%20amazing%20article%20at%20Genics%20Blog%20'Building%20a%20WhatsApp%20API%20using%20Node.js%20&amp;%20Express':%20https://genicsblog.com/usman/whatsapp-api-with-node-js-and-express" onclick="window.open(this.href, 'whatsapp-share', 'width=550,height=435');return false;" target="_blank"> <img src="/assets/images/social/whatsapp.svg" class="social-image w-10 h-10" loading="lazy"> </a> <a class="underline-none hover:scale-125 transition flex items-center" rel="nofollow noopener noreferrer" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://genicsblog.com/usman/whatsapp-api-with-node-js-and-express" onclick="window.open(this.href, 'linkedin-share', 'width=550,height=435');return false;" target="_blank"> <img src="/assets/images/social/linkedin.svg" class="social-image w-7 h-7" loading="lazy"> </a> <a class="underline-none hover:scale-125 transition flex items-center" rel="nofollow noopener noreferrer" href="https://twitter.com/intent/tweet?text=Check%20out%20this%20amazing%20article%20by%20@MaxProgramming1%20at%20@genicsblog:%20Building%20a%20WhatsApp%20API%20using%20Node.js%20&amp;%20Express&amp;url=https://genicsblog.com/usman/whatsapp-api-with-node-js-and-express" onclick="window.open(this.href, 'twitter-share', 'width=550,height=435');return false;" target="_blank"> <img src="/assets/images/social/twitter.svg" class="social-image w-8 h-8" loading="lazy"> </a> <a class="underline-none hover:scale-125 transition flex items-center" rel="nofollow noopener noreferrer" href="https://www.snapchat.com/scan?attachmentUrl=https://genicsblog.com/usman/whatsapp-api-with-node-js-and-express" onclick="window.open(this.href, 'snapchat-share', 'width=550,height=435');return false;" target="_blank"> <img src="/assets/images/social/snapchat.svg" class="social-image w-14 h-14 -m-2" loading="lazy"> </a> </div> </div> </div> </div> <aside class="m-6 md:m-10 lg:my-14 lg:mr-10 lg:-ml-4 md:mr-8 lg:max-w-[25%] xl:max-w-[20%]"> <figure class="bg-white dark:bg-background rounded-2xl p-6 md:p-8 shadow-xl dark:shadow-none shadow-slate-200"> <img class="w-24 h-24 rounded-full mx-auto" src="https://i.ibb.co/Fs6Kww8/PFP.jpg" alt="" loading="lazy"> <div class="pt-4 space-y-4"> <figcaption class="font-medium text-center"> <div> <a href="/author/usman/" class="text-xl font-bold"> Usman Sabuwala </a> </div> <div class="text-slate-700 dark:text-slate-200 text-sm"> Content creator &amp; Full stack dev </div> </figcaption> <p class="leading-5 font-medium text-justify"> I like to create content and teach people about web development. I like reading books and helping people! </p> </div> </figure> <figure class="bg-white dark:bg-background rounded-2xl p-6 shadow-xl shadow-slate-200 dark:shadow-none mt-8 aspect-square w-full"> <div align="center"> <ins class="adsbygoogle" style="display:block" data-ad-format="auto" data-full-width-responsive="true" data-ad-client="ca-pub-8114751086331659" data-ad-slot="8698895132"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> </div> </figure> <figure class="bg-white dark:bg-background rounded-2xl px-6 pb-6 md:px-8 shadow-xl shadow-slate-200 dark:shadow-none lg:sticky lg:top-24 mt-8"> <img src="https://dash.beyondwords.io/logo-dark.svg" class="w-full aspect-video hidden dark:block" loading="lazy"> <img src="https://dash.beyondwords.io/logo.svg" class="w-full aspect-video dark:hidden" loading="lazy"> <h4> BeyondWords <span class="text-xs text-white px-3 py-1 align-middle rounded-xl bg-primary">Sponsored</span> </h4> <p class="">BeyondWords is an AI voice and audio publishing platform that brings frictionless audio to writers, newsrooms, and businesses!</p> <div class="flex justify-center"> <a class="px-3 py-1 mt-4 rounded-md bg-black dark:bg-white text-white dark:text-black hover:shadow-lg hover:scale-110 transition underline-none text-center" href="https://beyondwords.io?utm_source=genicsblog.com&amp;utm_medium=cpc&amp;utm_campaign=advertisement" rel="nofollow" target="_blank"> Check it out &gt; </a> </div> </figure> </aside> </section> <div class="flex justify-center mx-6 md:mx-10 lg:mx-14"> <div class="grid grid-flow-row sm:grid-flow-col gap-x-8 items-center justify-between bg-white dark:bg-background rounded-2xl p-8 md:p-12 shadow-xl dark:shadow-none shadow-slate-200 w-full"> <section class="md:mr-4"> <h3>Contribute to the Genics Blog!</h3> <p> Genics Blog is a purely <a href="https://github.com/genicsblog" rel="nofollow noreferrer noopener" target="_blank" class="cta-link">open source</a> publication. Authors at Genics post highly resourceful content on varied topics relevant to the developer community. Join us and start publishing today! </p> </section> <a class="px-4 py-1.5 mt-8 md:mt-0 md:ml-4 rounded-md text-xl bg-black dark:bg-white text-white dark:text-black hover:shadow-lg hover:scale-110 transition underline-none text-center" href="/contribute"> Contribute </a> </div> </div> <br> <div align="center"> <ins class="adsbygoogle" style="display:block" data-ad-format="fluid" data-ad-layout-key="-fb+5w+4e-db+86" data-ad-client="ca-pub-8114751086331659" data-ad-slot="3535897708"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> </div> <br> <div class="m-8 md:m-10 lg:m-14"> <div class="flex justify-center"> <h1>Related content</h1> </div> <div class="flex flex-col sm:grid sm:grid-cols-2 lg:grid-cols-3 sm:gap-4 md:gap-4 lg:gap-6 text-center"> <a class="postbox mt-4 mb-6 px-6 pt-2 pb-6 bg-white dark:bg-background rounded-2xl shadow-xl shadow-slate-200 dark:shadow-none border-4 hover:border-web3 dark:hover:border-slate-200 dark:hover:!border-web3 dark:border-slate-600 transition underline-none" href="/kira/how-to-build-a-faucet-cli-using-node-js"> <img src="https://ik.imagekit.io/genicsblog/tr:w-1920,h-1080,f-webp/https://imgur.com/0qQxUt3.png" alt="How to build a faucet CLI using NodeJS üöÄ" title="How to build a faucet CLI using NodeJS üöÄ" class="aspect-video w-full mt-4" loading="lazy"> <div class="mt-6 mb-16"> <h2> How to build a faucet CLI using NodeJS üöÄ </h2> <p> The complete guide to building a faucet CLI using NodeJS. </p> </div> <div class="absolute mt-20 right-6 bottom-6 left-6"> <div class="flex items-center justify-between mt-6"> <div class="flex items-center"> <img src="https://avatars.githubusercontent.com/u/90365542?v=4" alt="Kira's Profile Picture" title="Kira's Profile Picture" class="rounded-full w-10 h-10" width="40px" height="40px" loading="lazy"> <span class="ml-2">Kira</span> </div> <span>Apr 24, 2022</span> </div> </div> </a> <a class="postbox mt-4 mb-6 px-6 pt-2 pb-6 bg-white dark:bg-background rounded-2xl shadow-xl shadow-slate-200 dark:shadow-none border-4 hover:border-backend dark:hover:border-slate-200 dark:hover:!border-backend dark:border-slate-600 transition underline-none" href="/dhruva/intro-to-graphql-with-node-and-typescript"> <img src="https://ik.imagekit.io/genicsblog/tr:w-1920,h-1080,f-webp/https://user-images.githubusercontent.com/46792249/151178959-781d2ea4-a4dc-4f89-90d9-b98d62821944.png" alt="Intro to GraphQL with Node.js and TypeScript" title="Intro to GraphQL with Node.js and TypeScript" class="aspect-video w-full mt-4" loading="lazy"> <div class="mt-6 mb-16"> <h2> Intro to GraphQL with Node.js and Typ... </h2> <p> The complete guide to working with GraphQL using TypeGraphQL and building a basic CRUD ... </p> </div> <div class="absolute mt-20 right-6 bottom-6 left-6"> <div class="flex items-center justify-between mt-6"> <div class="flex items-center"> <img src="https://avatars.githubusercontent.com/u/66675022" alt="Dhruva Srinivas's Profile Picture" title="Dhruva Srinivas's Profile Picture" class="rounded-full w-10 h-10" width="40px" height="40px" loading="lazy"> <span class="ml-2">Dhruva</span> </div> <span>Jan 26, 2022</span> </div> </div> </a> <a class="postbox mt-4 mb-6 px-6 pt-2 pb-6 bg-white dark:bg-background rounded-2xl shadow-xl shadow-slate-200 dark:shadow-none border-4 hover:border-backend dark:hover:border-slate-200 dark:hover:!border-backend dark:border-slate-600 transition underline-none" href="/kira/how-to-build-a-rest-api-using-nodejs"> <img src="https://ik.imagekit.io/genicsblog/tr:w-1920,h-1080,f-webp/https://user-images.githubusercontent.com/90365542/150640432-993a9fd8-4472-457c-9074-9e6fbd273743.png" alt="How to build a REST API using NodeJS" title="How to build a REST API using NodeJS" class="aspect-video w-full mt-4" loading="lazy"> <div class="mt-6 mb-16"> <h2> How to build a REST API using NodeJS </h2> <p> The guide to teach you how to build a REST API from beginning till deployment. </p> </div> <div class="absolute mt-20 right-6 bottom-6 left-6"> <div class="flex items-center justify-between mt-6"> <div class="flex items-center"> <img src="https://avatars.githubusercontent.com/u/90365542?v=4" alt="Kira's Profile Picture" title="Kira's Profile Picture" class="rounded-full w-10 h-10" width="40px" height="40px" loading="lazy"> <span class="ml-2">Kira</span> </div> <span>Jan 23, 2022</span> </div> </div> </a> </div> </div> <br> <div align="center"> <ins class="adsbygoogle" style="display:block" data-ad-format="fluid" data-ad-layout-key="-fb+5w+4e-db+86" data-ad-client="ca-pub-8114751086331659" data-ad-slot="3535897708"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> </div> <br> </main> <footer class="px-12 py-8 text-center"> ¬© 2021 <a href="/">Genics Blog</a> <br> Built with <a href="https://jekyllrb.com" target="_blank" rel="nofollow noopener noreferrer">Jekyll</a>. Hosted on <a href="https://github.com" target="_blank" rel="nofollow noopener noreferrer">GitHub</a>. <br><br> Developed by <a href="https://github.com/gouravkhunger" rel="nofollow noopener noreferrer" target="_blank"> Gourav Khunger</a>. Thanks to the <a href="https://github.com/genicsblog/genicsblog.com/graphs/contributors" rel="nofollow noopener noreferrer" target="_blank"> contributors</a>! <br><br> <a class="nav-item text-white" href="/terms">T&amp;C</a> <a class="nav-item text-white" href="/privacy-policy">Privacy Policy</a> <a class="nav-item text-white" href="/licensing">Licensing</a> </footer> <div class="hidden fixed top-0 w-full h-full p-6 md:p-14 backdrop-blur-md cursor-pointer z-20" id="search-container"> <div class="p-4 bg-white dark:bg-slate-800 mx-auto w-full max-h-full sm:w-3/4 lg:w-1/2 content-center rounded-lg shadow-md shadow-slate-200 dark:shadow-none cursor-auto overflow-auto" id="search-box"> <div class="flex items-center"> <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 stroke-slate-400" fill="none" viewbox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path> </svg> <input type="text" class="w-full h-full pl-4 text-2xl outline-none dark:bg-slate-800" id="search-input" placeholder="Search..."> <span class="hidden lg:block text-sm text-gray-600 text-right tracking-tight ml-2"> <kbd class="bg-gray-200 dark:bg-slate-600 dark:text-gray-200 rounded-md shadow-sm py-1 px-2">Esc</kbd> </span> </div> <div id="results-container"></div> </div> </div> <script src="/assets/js/theme.js"></script> <script src="/assets/js/search.js"></script> <script src="/assets/js/prism.js"></script> </body> </html>